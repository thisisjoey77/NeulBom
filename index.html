<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Coala Neulbom Home</title>
  <link rel="stylesheet" href="style.css">
  <script src="api-helper.js"></script>
</head>
<body>
  <div class="container">
    <h2>Welcome to Coala! ğŸ¨</h2>
    <h2>ğŸ¤ ìŒì„±ìœ¼ë¡œ ì§ˆë¬¸í•˜ê³ , AI ì‘ë‹µì„ ë“¤ìœ¼ì„¸ìš”</h2>
    <button id="start">ğŸ™ï¸ ë§í•˜ê¸° ì‹œì‘</button>
    <p><strong>ì…ë ¥ í…ìŠ¤íŠ¸:</strong> <span id="inputText"></span></p>
    <p><strong>AI ì‘ë‹µ:</strong> <span id="aiResponse"></span></p>
    <div>í˜„ì¬ ì¸ì›: <span id="playerCountDisplay">0</span>ëª…</div>
    <div style="margin: 16px 0;">
      <label for="gameSelect"><strong>ê²Œì„ ì„ íƒ:</strong></label>
      <select id="gameSelect" style="font-size:1em; padding:4px 8px;">
        <option value="index.html">Home</option>
        <option value="commandAI.html">Command AI</option>
        <option value="temp.html">Jump Game</option>
        <option value="369.html">369 Game</option>
        <option value="lastWord.html">ëë§ì‡ê¸° Game</option>
        <option value="gomoku.html">Gomoku Game</option>
        <option value="br31.html">BR31 Game</option>
        <option value="fruitList.html">Fruit List</option>
        <option value="flagGame.html">Flag Game</option>
        <option value="firstSoundGame.html">ì´ˆì„±ê²Œì„ (First Sound Game)</option>
        <option value="telephoneGame.html">Telephone Game</option>
        <option value="storyTime.html">Story Time</option>
        <option value="twentyQ.html">ìŠ¤ë¬´ê³ ê°œ (20 Questions)</option>
        <option value="guessPerson.html">ì¸ë¬¼ ë§íˆê¸° (Guess the Person)</option>
        <option value="imageGuess.html">ì´ë¯¸ì§€ í€´ì¦ˆ (Image Guess)</option>
      </select>
      <button id="startGameBtn" style="margin-left:10px; font-size:1em; padding:4px 16px;">ê²Œì„ ì‹œì‘</button>
    </div>
    <video id="cam" width="640" height="480" autoplay playsinline style="border: 2px solid #333; background-color: #000;"></video>
    <div>
      <p id="cameraStatus">Camera status: Loading...</p>
      <p id="detectionResults">Detection results: Waiting...</p>
    </div>
  </div>
  <script>
    document.getElementById('startGameBtn').onclick = function() {
      const game = document.getElementById('gameSelect').value;
      window.location.href = game;
    };
  </script>
  <script src="script.js"></script>
  <script>
    // Allow runtime override of BACKEND_URL (for Vercel env var injection)
    window.BACKEND_URL = window.BACKEND_URL || 'http://54.180.16.112:5000/process_frame';
  </script>
  <script>
    const video = document.getElementById('cam');
    const cameraStatus = document.getElementById('cameraStatus');
    const detectionResults = document.getElementById('detectionResults');
    let stream = null;
    const BACKEND_URL = window.BACKEND_URL || 'http://54.180.16.112:5000/process_frame';
    
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      cameraStatus.textContent = 'Camera status: Requesting permission...';
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(s => {
          stream = s;
          video.srcObject = stream;
          cameraStatus.textContent = 'Camera status: Connected âœ“';
          
          // Wait for video to load before starting frame upload
          video.addEventListener('loadedmetadata', () => {
            startFrameUpload();
          });
        })
        .catch(err => {
          console.error('Camera access denied:', err);
          cameraStatus.textContent = 'Camera status: Access denied or not available';
        });
    } else {
      cameraStatus.textContent = 'Camera status: getUserMedia not supported';
    }

    function startFrameUpload() {
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth || 640;
      canvas.height = video.videoHeight || 480;
      const ctx = canvas.getContext('2d');
      
      setInterval(() => {
        if (video.readyState === 4) {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
          canvas.toBlob(blob => {
            if (blob) {
              const formData = new FormData();
              formData.append('frame', blob, 'frame.jpg');
              fetch(BACKEND_URL, {
                method: 'POST',
                body: formData
              })
              .then(res => res.json())
              .then(data => {
                // Display detection results
                if (data.people !== undefined) {
                  detectionResults.textContent = `Detection results: ${data.people} people detected`;
                } else if (data.error) {
                  detectionResults.textContent = `Detection error: ${data.error}`;
                }
              })
              .catch(err => {
                console.error('Frame upload error:', err);
                detectionResults.textContent = 'Detection error: Network issue';
              });
            }
          }, 'image/jpeg', 0.8);
        }
      }, 1000);
    }
  </script>
</body>
</html>


